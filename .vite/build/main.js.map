{"version":3,"file":"main.js","sources":["../../electron/main.ts"],"sourcesContent":["/**\n * Mimiverse IDE - Electron Main Process\n * Production-ready desktop application entry point\n */\n\nimport { app, BrowserWindow, ipcMain, dialog, shell, Menu } from 'electron';\nimport * as path from 'path';\nimport * as fs from 'fs';\n\nimport { createRequire } from 'node:module';\n\nconst require = createRequire(import.meta.url);\n\n// Handle creating/removing shortcuts on Windows when installing/uninstalling\nif (require('electron-squirrel-startup')) {\n    app.quit();\n}\n\n// Fix for SUID sandbox helper binary issue on some Linux environments\napp.commandLine.appendSwitch('no-sandbox');\napp.commandLine.appendSwitch('disable-gpu-sandbox');\n\nlet mainWindow: BrowserWindow | null = null;\nconst isDev = process.env.NODE_ENV === 'development';\n\n// ==================== WINDOW CREATION ====================\n\nasync function createWindow(): Promise<void> {\n    mainWindow = new BrowserWindow({\n        width: 1600,\n        height: 1000,\n        minWidth: 1024,\n        minHeight: 768,\n        title: 'Mimiverse IDE',\n        icon: path.join(__dirname, '../assets/icon.png'),\n        titleBarStyle: 'hiddenInset', // macOS native look\n        trafficLightPosition: { x: 15, y: 15 },\n        backgroundColor: '#0a0a0f', // Dark theme background\n        webPreferences: {\n            nodeIntegration: false,\n            contextIsolation: true,\n            sandbox: true,\n            preload: path.join(__dirname, 'preload.js'),\n            webSecurity: true,\n        },\n        show: false, // Don't show until ready\n    });\n\n    // Show window when ready to prevent white flash\n    mainWindow.once('ready-to-show', () => {\n        mainWindow?.show();\n        if (isDev) {\n            mainWindow?.webContents.openDevTools();\n        }\n    });\n\n    // Load the app\n    if (isDev) {\n        // Development: load from Vite dev server\n        await mainWindow.loadURL('http://localhost:5000');\n    } else {\n        // Production: load built files\n        await mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));\n    }\n\n    // Handle external links\n    mainWindow.webContents.setWindowOpenHandler(({ url }) => {\n        shell.openExternal(url);\n        return { action: 'deny' };\n    });\n\n    // Cleanup on close\n    mainWindow.on('closed', () => {\n        mainWindow = null;\n    });\n}\n\n// ==================== APPLICATION MENU ====================\n\nfunction createMenu(): void {\n    const isMac = process.platform === 'darwin';\n\n    const template: Electron.MenuItemConstructorOptions[] = [\n        // App menu (macOS only)\n        ...(isMac ? [{\n            label: app.name,\n            submenu: [\n                { role: 'about' as const },\n                { type: 'separator' as const },\n                { role: 'services' as const },\n                { type: 'separator' as const },\n                { role: 'hide' as const },\n                { role: 'hideOthers' as const },\n                { role: 'unhide' as const },\n                { type: 'separator' as const },\n                { role: 'quit' as const },\n            ],\n        }] : []),\n        // File menu\n        {\n            label: 'File',\n            submenu: [\n                {\n                    label: 'Open Folder...',\n                    accelerator: 'CmdOrCtrl+O',\n                    click: async () => {\n                        const result = await dialog.showOpenDialog(mainWindow!, {\n                            properties: ['openDirectory'],\n                        });\n                        if (!result.canceled && result.filePaths[0]) {\n                            mainWindow?.webContents.send('folder-opened', result.filePaths[0]);\n                        }\n                    },\n                },\n                { type: 'separator' },\n                {\n                    label: 'Save',\n                    accelerator: 'CmdOrCtrl+S',\n                    click: () => mainWindow?.webContents.send('save-file'),\n                },\n                {\n                    label: 'Save All',\n                    accelerator: 'CmdOrCtrl+Shift+S',\n                    click: () => mainWindow?.webContents.send('save-all-files'),\n                },\n                { type: 'separator' },\n                isMac ? { role: 'close' as const } : { role: 'quit' as const },\n            ],\n        },\n        // Edit menu\n        {\n            label: 'Edit',\n            submenu: [\n                { role: 'undo' as const },\n                { role: 'redo' as const },\n                { type: 'separator' as const },\n                { role: 'cut' as const },\n                { role: 'copy' as const },\n                { role: 'paste' as const },\n                { role: 'selectAll' as const },\n            ],\n        },\n        // View menu\n        {\n            label: 'View',\n            submenu: [\n                { role: 'reload' as const },\n                { role: 'forceReload' as const },\n                { role: 'toggleDevTools' as const },\n                { type: 'separator' as const },\n                { role: 'resetZoom' as const },\n                { role: 'zoomIn' as const },\n                { role: 'zoomOut' as const },\n                { type: 'separator' as const },\n                { role: 'togglefullscreen' as const },\n            ],\n        },\n        // AI menu (Mimiverse specific)\n        {\n            label: 'AI',\n            submenu: [\n                {\n                    label: 'Toggle AI Chat',\n                    accelerator: 'CmdOrCtrl+Shift+A',\n                    click: () => mainWindow?.webContents.send('toggle-ai-chat'),\n                },\n                {\n                    label: 'Start Build',\n                    accelerator: 'CmdOrCtrl+Shift+B',\n                    click: () => mainWindow?.webContents.send('start-build'),\n                },\n                { type: 'separator' },\n                {\n                    label: 'Run Tests',\n                    accelerator: 'CmdOrCtrl+Shift+T',\n                    click: () => mainWindow?.webContents.send('run-tests'),\n                },\n                {\n                    label: 'Auto-Fix',\n                    accelerator: 'CmdOrCtrl+Shift+F',\n                    click: () => mainWindow?.webContents.send('auto-fix'),\n                },\n            ],\n        },\n        // Help menu\n        {\n            label: 'Help',\n            submenu: [\n                {\n                    label: 'Documentation',\n                    click: () => shell.openExternal('https://mimiverse.ai/docs'),\n                },\n                {\n                    label: 'Report Issue',\n                    click: () => shell.openExternal('https://github.com/mimiverse/ide/issues'),\n                },\n                { type: 'separator' },\n                {\n                    label: 'About Mimiverse',\n                    click: () => {\n                        dialog.showMessageBox(mainWindow!, {\n                            type: 'info',\n                            title: 'About Mimiverse IDE',\n                            message: 'Mimiverse IDE',\n                            detail: `Version: ${app.getVersion()}\\nElectron: ${process.versions.electron}\\nChrome: ${process.versions.chrome}\\nNode.js: ${process.versions.node}`,\n                        });\n                    },\n                },\n            ],\n        },\n    ];\n\n    const menu = Menu.buildFromTemplate(template);\n    Menu.setApplicationMenu(menu);\n}\n\n// ==================== IPC HANDLERS ====================\n\nfunction setupIpcHandlers(): void {\n    // File operations\n    ipcMain.handle('read-file', async (_event, filePath: string) => {\n        try {\n            const content = await fs.promises.readFile(filePath, 'utf-8');\n            return { success: true, content };\n        } catch (error: any) {\n            return { success: false, error: error.message };\n        }\n    });\n\n    ipcMain.handle('write-file', async (_event, filePath: string, content: string) => {\n        try {\n            await fs.promises.writeFile(filePath, content, 'utf-8');\n            return { success: true };\n        } catch (error: any) {\n            return { success: false, error: error.message };\n        }\n    });\n\n    ipcMain.handle('list-directory', async (_event, dirPath: string) => {\n        try {\n            const entries = await fs.promises.readdir(dirPath, { withFileTypes: true });\n            const files = entries.map(entry => ({\n                name: entry.name,\n                isDirectory: entry.isDirectory(),\n                path: path.join(dirPath, entry.name),\n            }));\n            return { success: true, files };\n        } catch (error: any) {\n            return { success: false, error: error.message };\n        }\n    });\n\n    // Dialog operations\n    ipcMain.handle('show-open-dialog', async (_event, options) => {\n        return dialog.showOpenDialog(mainWindow!, options);\n    });\n\n    ipcMain.handle('show-save-dialog', async (_event, options) => {\n        return dialog.showSaveDialog(mainWindow!, options);\n    });\n\n    // Shell operations\n    ipcMain.handle('open-external', async (_event, url: string) => {\n        await shell.openExternal(url);\n    });\n\n    ipcMain.handle('show-item-in-folder', async (_event, fullPath: string) => {\n        shell.showItemInFolder(fullPath);\n    });\n\n    // App info\n    ipcMain.handle('get-app-version', () => app.getVersion());\n    ipcMain.handle('get-platform', () => process.platform);\n}\n\n// ==================== APP LIFECYCLE ====================\n\napp.on('ready', async () => {\n    createMenu();\n    setupIpcHandlers();\n    await createWindow();\n});\n\napp.on('window-all-closed', () => {\n    if (process.platform !== 'darwin') {\n        app.quit();\n    }\n});\n\napp.on('activate', async () => {\n    if (BrowserWindow.getAllWindows().length === 0) {\n        await createWindow();\n    }\n});\n\n// Security: Prevent new window creation\napp.on('web-contents-created', (_event, contents) => {\n    contents.on('will-navigate', (event, url) => {\n        const parsedUrl = new URL(url);\n        if (parsedUrl.protocol !== 'file:' && parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n            event.preventDefault();\n        }\n    });\n});\n\n// Handle certificate errors in development\nif (isDev) {\n    app.on('certificate-error', (event, _webContents, _url, _error, _certificate, callback) => {\n        event.preventDefault();\n        callback(true);\n    });\n}\n\nconsole.log('[Electron] Mimiverse IDE starting...');\n"],"names":["require"],"mappings":";;;;AAWA,MAAMA,WAAU,cAAc,YAAY,GAAG;AAG7C,IAAIA,SAAQ,2BAA2B,GAAG;AACtC,MAAI,KAAA;AACR;AAGA,IAAI,YAAY,aAAa,YAAY;AACzC,IAAI,YAAY,aAAa,qBAAqB;AAElD,IAAI,aAAmC;AACvC,MAAM,QAAQ,QAAQ,IAAI,aAAa;AAIvC,eAAe,eAA8B;AACzC,eAAa,IAAI,cAAc;AAAA,IAC3B,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,WAAW;AAAA,IACX,OAAO;AAAA,IACP,MAAM,KAAK,KAAK,WAAW,oBAAoB;AAAA,IAC/C,eAAe;AAAA;AAAA,IACf,sBAAsB,EAAE,GAAG,IAAI,GAAG,GAAA;AAAA,IAClC,iBAAiB;AAAA;AAAA,IACjB,gBAAgB;AAAA,MACZ,iBAAiB;AAAA,MACjB,kBAAkB;AAAA,MAClB,SAAS;AAAA,MACT,SAAS,KAAK,KAAK,WAAW,YAAY;AAAA,MAC1C,aAAa;AAAA,IAAA;AAAA,IAEjB,MAAM;AAAA;AAAA,EAAA,CACT;AAGD,aAAW,KAAK,iBAAiB,MAAM;AACnC,6CAAY;AACZ,QAAI,OAAO;AACP,+CAAY,YAAY;AAAA,IAC5B;AAAA,EACJ,CAAC;AAGD,MAAI,OAAO;AAEP,UAAM,WAAW,QAAQ,uBAAuB;AAAA,EACpD,OAAO;AAEH,UAAM,WAAW,SAAS,KAAK,KAAK,WAAW,oBAAoB,CAAC;AAAA,EACxE;AAGA,aAAW,YAAY,qBAAqB,CAAC,EAAE,UAAU;AACrD,UAAM,aAAa,GAAG;AACtB,WAAO,EAAE,QAAQ,OAAA;AAAA,EACrB,CAAC;AAGD,aAAW,GAAG,UAAU,MAAM;AAC1B,iBAAa;AAAA,EACjB,CAAC;AACL;AAIA,SAAS,aAAmB;AACxB,QAAM,QAAQ,QAAQ,aAAa;AAEnC,QAAM,WAAkD;AAAA;AAAA,IAEpD,GAAI,QAAQ,CAAC;AAAA,MACT,OAAO,IAAI;AAAA,MACX,SAAS;AAAA,QACL,EAAE,MAAM,QAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,WAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,OAAA;AAAA,QACR,EAAE,MAAM,aAAA;AAAA,QACR,EAAE,MAAM,SAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,OAAA;AAAA,MAAgB;AAAA,IAC5B,CACH,IAAI,CAAA;AAAA;AAAA,IAEL;AAAA,MACI,OAAO;AAAA,MACP,SAAS;AAAA,QACL;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,YAAY;AACf,kBAAM,SAAS,MAAM,OAAO,eAAe,YAAa;AAAA,cACpD,YAAY,CAAC,eAAe;AAAA,YAAA,CAC/B;AACD,gBAAI,CAAC,OAAO,YAAY,OAAO,UAAU,CAAC,GAAG;AACzC,uDAAY,YAAY,KAAK,iBAAiB,OAAO,UAAU,CAAC;AAAA,YACpE;AAAA,UACJ;AAAA,QAAA;AAAA,QAEJ,EAAE,MAAM,YAAA;AAAA,QACR;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAW;AAAA,QAEzD;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAgB;AAAA,QAE9D,EAAE,MAAM,YAAA;AAAA,QACR,QAAQ,EAAE,MAAM,YAAqB,EAAE,MAAM,OAAA;AAAA,MAAgB;AAAA,IACjE;AAAA;AAAA,IAGJ;AAAA,MACI,OAAO;AAAA,MACP,SAAS;AAAA,QACL,EAAE,MAAM,OAAA;AAAA,QACR,EAAE,MAAM,OAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,MAAA;AAAA,QACR,EAAE,MAAM,OAAA;AAAA,QACR,EAAE,MAAM,QAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,MAAqB;AAAA,IACjC;AAAA;AAAA,IAGJ;AAAA,MACI,OAAO;AAAA,MACP,SAAS;AAAA,QACL,EAAE,MAAM,SAAA;AAAA,QACR,EAAE,MAAM,cAAA;AAAA,QACR,EAAE,MAAM,iBAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,SAAA;AAAA,QACR,EAAE,MAAM,UAAA;AAAA,QACR,EAAE,MAAM,YAAA;AAAA,QACR,EAAE,MAAM,mBAAA;AAAA,MAA4B;AAAA,IACxC;AAAA;AAAA,IAGJ;AAAA,MACI,OAAO;AAAA,MACP,SAAS;AAAA,QACL;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAgB;AAAA,QAE9D;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAa;AAAA,QAE3D,EAAE,MAAM,YAAA;AAAA,QACR;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAW;AAAA,QAEzD;AAAA,UACI,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM,yCAAY,YAAY,KAAK;AAAA,QAAU;AAAA,MACxD;AAAA,IACJ;AAAA;AAAA,IAGJ;AAAA,MACI,OAAO;AAAA,MACP,SAAS;AAAA,QACL;AAAA,UACI,OAAO;AAAA,UACP,OAAO,MAAM,MAAM,aAAa,2BAA2B;AAAA,QAAA;AAAA,QAE/D;AAAA,UACI,OAAO;AAAA,UACP,OAAO,MAAM,MAAM,aAAa,yCAAyC;AAAA,QAAA;AAAA,QAE7E,EAAE,MAAM,YAAA;AAAA,QACR;AAAA,UACI,OAAO;AAAA,UACP,OAAO,MAAM;AACT,mBAAO,eAAe,YAAa;AAAA,cAC/B,MAAM;AAAA,cACN,OAAO;AAAA,cACP,SAAS;AAAA,cACT,QAAQ,YAAY,IAAI,WAAA,CAAY;AAAA,YAAe,QAAQ,SAAS,QAAQ;AAAA,UAAa,QAAQ,SAAS,MAAM;AAAA,WAAc,QAAQ,SAAS,IAAI;AAAA,YAAA,CACtJ;AAAA,UACL;AAAA,QAAA;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAGJ,QAAM,OAAO,KAAK,kBAAkB,QAAQ;AAC5C,OAAK,mBAAmB,IAAI;AAChC;AAIA,SAAS,mBAAyB;AAE9B,UAAQ,OAAO,aAAa,OAAO,QAAQ,aAAqB;AAC5D,QAAI;AACA,YAAM,UAAU,MAAM,GAAG,SAAS,SAAS,UAAU,OAAO;AAC5D,aAAO,EAAE,SAAS,MAAM,QAAA;AAAA,IAC5B,SAAS,OAAY;AACjB,aAAO,EAAE,SAAS,OAAO,OAAO,MAAM,QAAA;AAAA,IAC1C;AAAA,EACJ,CAAC;AAED,UAAQ,OAAO,cAAc,OAAO,QAAQ,UAAkB,YAAoB;AAC9E,QAAI;AACA,YAAM,GAAG,SAAS,UAAU,UAAU,SAAS,OAAO;AACtD,aAAO,EAAE,SAAS,KAAA;AAAA,IACtB,SAAS,OAAY;AACjB,aAAO,EAAE,SAAS,OAAO,OAAO,MAAM,QAAA;AAAA,IAC1C;AAAA,EACJ,CAAC;AAED,UAAQ,OAAO,kBAAkB,OAAO,QAAQ,YAAoB;AAChE,QAAI;AACA,YAAM,UAAU,MAAM,GAAG,SAAS,QAAQ,SAAS,EAAE,eAAe,MAAM;AAC1E,YAAM,QAAQ,QAAQ,IAAI,CAAA,WAAU;AAAA,QAChC,MAAM,MAAM;AAAA,QACZ,aAAa,MAAM,YAAA;AAAA,QACnB,MAAM,KAAK,KAAK,SAAS,MAAM,IAAI;AAAA,MAAA,EACrC;AACF,aAAO,EAAE,SAAS,MAAM,MAAA;AAAA,IAC5B,SAAS,OAAY;AACjB,aAAO,EAAE,SAAS,OAAO,OAAO,MAAM,QAAA;AAAA,IAC1C;AAAA,EACJ,CAAC;AAGD,UAAQ,OAAO,oBAAoB,OAAO,QAAQ,YAAY;AAC1D,WAAO,OAAO,eAAe,YAAa,OAAO;AAAA,EACrD,CAAC;AAED,UAAQ,OAAO,oBAAoB,OAAO,QAAQ,YAAY;AAC1D,WAAO,OAAO,eAAe,YAAa,OAAO;AAAA,EACrD,CAAC;AAGD,UAAQ,OAAO,iBAAiB,OAAO,QAAQ,QAAgB;AAC3D,UAAM,MAAM,aAAa,GAAG;AAAA,EAChC,CAAC;AAED,UAAQ,OAAO,uBAAuB,OAAO,QAAQ,aAAqB;AACtE,UAAM,iBAAiB,QAAQ;AAAA,EACnC,CAAC;AAGD,UAAQ,OAAO,mBAAmB,MAAM,IAAI,YAAY;AACxD,UAAQ,OAAO,gBAAgB,MAAM,QAAQ,QAAQ;AACzD;AAIA,IAAI,GAAG,SAAS,YAAY;AACxB,aAAA;AACA,mBAAA;AACA,QAAM,aAAA;AACV,CAAC;AAED,IAAI,GAAG,qBAAqB,MAAM;AAC9B,MAAI,QAAQ,aAAa,UAAU;AAC/B,QAAI,KAAA;AAAA,EACR;AACJ,CAAC;AAED,IAAI,GAAG,YAAY,YAAY;AAC3B,MAAI,cAAc,gBAAgB,WAAW,GAAG;AAC5C,UAAM,aAAA;AAAA,EACV;AACJ,CAAC;AAGD,IAAI,GAAG,wBAAwB,CAAC,QAAQ,aAAa;AACjD,WAAS,GAAG,iBAAiB,CAAC,OAAO,QAAQ;AACzC,UAAM,YAAY,IAAI,IAAI,GAAG;AAC7B,QAAI,UAAU,aAAa,WAAW,UAAU,aAAa,WAAW,UAAU,aAAa,UAAU;AACrG,YAAM,eAAA;AAAA,IACV;AAAA,EACJ,CAAC;AACL,CAAC;AAGD,IAAI,OAAO;AACP,MAAI,GAAG,qBAAqB,CAAC,OAAO,cAAc,MAAM,QAAQ,cAAc,aAAa;AACvF,UAAM,eAAA;AACN,aAAS,IAAI;AAAA,EACjB,CAAC;AACL;AAEA,QAAQ,IAAI,sCAAsC;"}